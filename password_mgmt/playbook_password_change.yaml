---
 - name: playbook for changing User password on multiple servers
   hosts: testserver
   user: autoadmin
   become: yes

   vars_prompt:
       - name: user_name
         private: no
         prompt: "Enter the user name for which password needs to be changed:"

       - name: user_hashed_pass
         private: yes
#        prompt: "Enter the password hash generated by python command:"
         prompt: "Enter the password "
         encrypt: "sha512_crypt"
         confirm: yes
         salt_size: 7

   tasks:
      - name: Get user info
        shell: egrep "^{{ user_name }}:" /etc/passwd
        ignore_errors: yes
        register: user_info

      - name: user password change
        user:
           name={{ user_name }}
           update_password=always
           password="{{ user_hashed_pass }}"
        when: user_info.rc == 0



####### python -c 'import crypt,getpass; print crypt.crypt(getpass.getpass())'  #####

