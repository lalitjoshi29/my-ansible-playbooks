  

cat playbook_cronlist.yml 

--- 

- name: Playbook - list crontabs of users 

  hosts: all 

  become: yes 

  

  vars: 

     CRONINFO: cronfiles_of_{{ ansible_hostname }}.txt 

  

  tasks: 

    - name: Task 1 - Checking contents of crontab files ...... 

      script: /etc/ansible/cronjob_info/croninfo.sh >> /var/tmp/{{ CRONINFO }} 

  

  

    - name: Task 2 - Fetching cronjob info to local server's '/var/tmp/croninfo' directory ..... 

      fetch: 

        src: /var/tmp/{{ CRONINFO }} 

        dest: /var/tmp/croninfo/{{ CRONINFO }} 

        flat: yes 

  

  

    - name: Task 3 - Creating a consolidated report under '/var/tmp/croninfo/report/' directory... 

      assemble: 

         src: /var/tmp/croninfo 

         dest: /var/tmp/croninfo/report/cronreport_allservers.txt 

         owner: myadmin 

         delimiter: '### ##### ##### ### #### #### ##### ###### ######' 

      run_once: true 

      delegate_to: localhost 

  

  

    - name: Task 4 - Cleaning up temporary files.......... 

      file: 

        path: /var/tmp/{{ CRONINFO }} 

        state: absent 

  

  

--------------------------------------------------------------------------------------------------------------------------------------------------- 

cat croninfo.sh 

#!/bin/bash 

CRONDIR=/var/spool/cron 

echo " " 

hostname 

echo "-----------------" 

if [ -z "$(ls -A /var/spool/cron)" ]; then 

  echo " " 

  echo " No cron jobs running on this server  :( " 

  echo " " 

  echo " " 

else 

echo "cron jobs running for following user(s): " 

echo "-----------------------------------------" 

ls -1 $CRONDIR 

echo " " 

fi 

for i in `ls -1 $CRONDIR`; 

     do 

       echo " " 

       echo "cron jobs of '$i' are listed as below:" 

       echo "-------------------------------------" 

       cat $CRONDIR/$i 

       echo " " 

       echo " " 

       echo " " 

done 

 